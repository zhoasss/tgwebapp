# –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π –∑–∞–ø–∏—Å–µ–π

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** `docker-compose.yml`
- –ò–∑–º–µ–Ω–µ–Ω—ã –ø—Ä–∞–≤–∞ —Å `666` (—á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å –¥–ª—è –≤—Å–µ—Ö) –Ω–∞ `660` (—Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –∏ –≥—Ä—É–ø–ø–∞)
- –ü–æ–≤—ã—à–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 2. –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã Alembic –º–∏–≥—Ä–∞—Ü–∏–∏

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `backend/alembic.ini` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic
- `backend/alembic/env.py` - –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π
- `backend/alembic/script.py.mako` - —à–∞–±–ª–æ–Ω –º–∏–≥—Ä–∞—Ü–∏–π
- `backend/alembic/versions/001_initial.py` - –Ω–∞—á–∞–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
- `backend/alembic/README.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

**–ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏:**

```bash
# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
cd backend
alembic revision --autogenerate -m "Description of changes"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
alembic downgrade -1

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –º–∏–≥—Ä–∞—Ü–∏–π
alembic history

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é
alembic current
```

### 3. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π –∑–∞–ø–∏—Å–µ–π

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `backend/src/shared/utils/appointment_utils.py` - —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–ø–∏—Å—è–º–∏

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**

#### `check_appointment_overlap()`
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏:
- –£—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø–∏—Å–∏ (pending, confirmed)
- –ò—Å–∫–ª—é—á–∞–µ—Ç –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

#### `validate_appointment_time()`
–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–ø–∏—Å–∏:
- ‚úÖ –ó–∞–ø–∏—Å—å –Ω–µ –≤ –ø—Ä–æ—à–ª–æ–º
- ‚úÖ –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –†–∞–∑—É–º–Ω–∞—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–¥–æ 8 —á–∞—Å–æ–≤)
- ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π —Å –¥—Ä—É–≥–∏–º–∏ –∑–∞–ø–∏—Å—è–º–∏

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ API:**

–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤:
- `POST /api/appointments/` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
- `PUT /api/appointments/{id}` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏

**–ü—Ä–∏–º–µ—Ä—ã –æ—à–∏–±–æ–∫:**

```json
{
  "detail": "–í—Ä–µ–º—è –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞–ø–∏—Å—å—é: 14.11.2025 14:00 - 15:00 (–ö–ª–∏–µ–Ω—Ç: –ò–≤–∞–Ω)"
}
```

```json
{
  "detail": "–ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ –ø—Ä–æ—à–ª–æ–º"
}
```

```json
{
  "detail": "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 8 —á–∞—Å–æ–≤"
}
```

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π

```javascript
// Frontend
const response = await apiClient.post('/api/appointments', {
  service_id: 1,
  client_id: 2,
  appointment_date: '2025-11-28T14:00:00',
  duration_minutes: 60
});

// –ï—Å–ª–∏ –≤—Ä–µ–º—è –∑–∞–Ω—è—Ç–æ, –ø–æ–ª—É—á–∏–º –æ—à–∏–±–∫—É 400
// {
//   "detail": "–í—Ä–µ–º—è –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞–ø–∏—Å—å—é: ..."
// }
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏

```javascript
// –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –∏–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
// –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è
const response = await apiClient.put('/api/appointments/123', {
  appointment_date: '2025-11-28T15:00:00'
});
```

## üìä –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π

–ó–∞–ø–∏—Å—å A –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è —Å –∑–∞–ø–∏—Å—å—é B, –µ—Å–ª–∏:

1. **A –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è B**
   ```
   B: |-------|
   A:    |-------|
   ```

2. **A –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è B**
   ```
   B:     |-------|
   A: |-------|
   ```

3. **A –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç B**
   ```
   B:   |---|
   A: |-------|
   ```

4. **B –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç A**
   ```
   B: |-------|
   A:   |---|
   ```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–ø–∏—Å—å –Ω–∞ 14:00 –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é 60 –º–∏–Ω—É—Ç
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –Ω–∞ 14:30 - –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞
3. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–ø–∏—Å—å –Ω–∞ 15:00 - –¥–æ–ª–∂–Ω–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞—Ç—å—Å—è
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è –ø–µ—Ä–≤–æ–π –∑–∞–ø–∏—Å–∏ –Ω–∞ 15:00 - –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã (TODO)

```python
# backend/tests/test_appointment_overlap.py
async def test_appointment_overlap():
    # –°–æ–∑–¥–∞–µ–º –ø–µ—Ä–≤—É—é –∑–∞–ø–∏—Å—å
    appointment1 = await create_appointment(
        date=datetime(2025, 11, 28, 14, 0),
        duration=60
    )
    
    # –ü—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–µ—Å–µ–∫–∞—é—â—É—é—Å—è –∑–∞–ø–∏—Å—å
    with pytest.raises(HTTPException) as exc:
        await create_appointment(
            date=datetime(2025, 11, 28, 14, 30),
            duration=60
        )
    
    assert exc.value.status_code == 400
    assert "–ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è" in exc.value.detail.lower()
```

## üöÄ –î–µ–ø–ª–æ–π

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞ –Ω–∞ production:

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
docker-compose down

# 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
docker-compose run backend alembic upgrade head

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
docker-compose up -d

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs -f backend
```

## üìù Changelog

### 2025-11-28
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î (666 ‚Üí 660)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã Alembic –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –Ω–∞—á–∞–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å–æ –≤—Å–µ–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π –∑–∞–ø–∏—Å–µ–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–ø–∏—Å–µ–π
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ API endpoints

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `docker-compose.yml` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker
- `backend/alembic/` - –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- `backend/src/shared/utils/appointment_utils.py` - —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –∑–∞–ø–∏—Å–µ–π
- `backend/src/features/api/appointments.py` - API endpoints
