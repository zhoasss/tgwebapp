# üîî –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç Telegram —Å–æ–æ–±—â–µ–Ω–∏—è –º–∞—Å—Ç–µ—Ä–∞–º –æ –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö –≤ –∏—Ö –±–∏–∑–Ω–µ—Å–µ.

---

## üìã –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### 1. **–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å** üÜï
–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –º–∞—Å—Ç–µ—Ä—É –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—É—é —Å—Å—ã–ª–∫—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.

**–°–æ–¥–µ—Ä–∂–∏—Ç:**
- üë§ –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞
- üìû –¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞
- üìß Email (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)
- ‚úÇÔ∏è –ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏
- üìÖ –î–∞—Ç–∞ –∑–∞–ø–∏—Å–∏
- ‚è∞ –í—Ä–µ–º—è –∑–∞–ø–∏—Å–∏
- ‚è±Ô∏è –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- üí∞ –¶–µ–Ω–∞
- üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫–ª–∏–µ–Ω—Ç–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
- üìä –°—Ç–∞—Ç—É—Å (–æ–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)

**–ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è:**
```
üîî –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å!

üë§ –ö–ª–∏–µ–Ω—Ç: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤
üìû –¢–µ–ª–µ—Ñ–æ–Ω: +7 (999) 123-45-67
üìß Email: ivan@example.com
‚úÇÔ∏è –£—Å–ª—É–≥–∞: –°—Ç—Ä–∏–∂–∫–∞ –º—É–∂—Å–∫–∞—è
üìÖ –î–∞—Ç–∞: 15.12.2025
‚è∞ –í—Ä–µ–º—è: 14:00
‚è±Ô∏è –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 60 –º–∏–Ω
üí∞ –¶–µ–Ω–∞: 1500 ‚ÇΩ

üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:
–•–æ—á—É –∫–æ—Ä–æ—Ç–∫—É—é —Å—Ç—Ä–∏–∂–∫—É

üìä –°—Ç–∞—Ç—É—Å: –û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

üí° –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏
```

### 2. **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∑–∞–ø–∏—Å–∏** ‚è∞
–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –º–∞—Å—Ç–µ—Ä—É –∑–∞ N —á–∞—Å–æ–≤ –¥–æ –∑–∞–ø–∏—Å–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞ 24 —á–∞—Å–∞).

**–°–æ–¥–µ—Ä–∂–∏—Ç:**
- üë§ –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞
- üìû –¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞
- ‚úÇÔ∏è –ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏
- üìÖ –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
- ‚è±Ô∏è –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- üí∞ –¶–µ–Ω–∞
- üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–µ—Å–ª–∏ –µ—Å—Ç—å)

**–ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è:**
```
‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∑–∞–ø–∏—Å–∏

–ß–µ—Ä–µ–∑ 24 —á–∞—Å–æ–≤ —É –≤–∞—Å –∑–∞–ø–∏—Å—å:

üë§ –ö–ª–∏–µ–Ω—Ç: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤
üìû –¢–µ–ª–µ—Ñ–æ–Ω: +7 (999) 123-45-67
‚úÇÔ∏è –£—Å–ª—É–≥–∞: –°—Ç—Ä–∏–∂–∫–∞ –º—É–∂—Å–∫–∞—è
üìÖ –î–∞—Ç–∞: 15.12.2025
‚è∞ –í—Ä–µ–º—è: 14:00
‚è±Ô∏è –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 60 –º–∏–Ω
üí∞ –¶–µ–Ω–∞: 1500 ‚ÇΩ
```

### 3. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞** üìù
–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–ø–∏—Å–∏.

**–°—Ç–∞—Ç—É—Å—ã:**
- ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞
- ‚ùå –û—Ç–º–µ–Ω–µ–Ω–∞
- ‚úîÔ∏è –ó–∞–≤–µ—Ä—à–µ–Ω–∞
- ‚è≥ –û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è:**
```
‚úÖ –ó–∞–ø–∏—Å—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞

‚úÇÔ∏è –£—Å–ª—É–≥–∞: –°—Ç—Ä–∏–∂–∫–∞ –º—É–∂—Å–∫–∞—è
üìÖ –î–∞—Ç–∞: 15.12.2025
‚è∞ –í—Ä–µ–º—è: 14:00
```

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ú–æ–¥—É–ª—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```
backend/src/shared/notifications/
‚îú‚îÄ‚îÄ __init__.py
‚îî‚îÄ‚îÄ telegram_notifier.py  # –ö–ª–∞—Å—Å TelegramNotifier
```

### –ö–ª–∞—Å—Å TelegramNotifier

```python
class TelegramNotifier:
    """–ö–ª–∞—Å—Å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"""
    
    def __init__(self, bot_token: Optional[str] = None)
    
    async def send_new_appointment_notification(
        telegram_id: int,
        appointment_data: dict
    ) -> bool
    
    async def send_appointment_reminder(
        telegram_id: int,
        appointment_data: dict,
        hours_before: int = 24
    ) -> bool
    
    async def send_appointment_status_update(
        telegram_id: int,
        appointment_data: dict,
        new_status: str
    ) -> bool
    
    async def test_connection(telegram_id: int) -> bool
```

---

## üîå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### 1. –ü—É–±–ª–∏—á–Ω–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

**–§–∞–π–ª:** `backend/src/features/api/public_booking.py`

```python
from ...shared.notifications.telegram_notifier import TelegramNotifier

@router.post("/{booking_slug}/book")
async def create_public_booking(...):
    # ... —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ ...
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    try:
        notifier = TelegramNotifier()
        await notifier.send_new_appointment_notification(
            telegram_id=user.telegram_id,
            appointment_data={
                "id": appointment.id,
                "client_name": f"{client.first_name} {client.last_name}",
                "client_phone": client.phone,
                "client_email": client.email,
                "service_name": service.name,
                "appointment_date": appointment.appointment_date.isoformat(),
                "duration_minutes": appointment.duration_minutes,
                "price": appointment.price,
                "notes": appointment.client_notes
            }
        )
    except Exception as e:
        logging.error(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: {e}")
```

### 2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–ø–∏—Å–∏

**–§–∞–π–ª:** `backend/src/features/api/appointments.py`

```python
@router.patch("/{appointment_id}/status")
async def update_appointment_status(...):
    # ... –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ ...
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    notifier = TelegramNotifier()
    await notifier.send_appointment_status_update(
        telegram_id=user.telegram_id,
        appointment_data=appointment_data,
        new_status=new_status
    )
```

---

## üìÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π (TODO)

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **APScheduler**:

```python
# backend/src/shared/scheduler/reminder_scheduler.py
from apscheduler.schedulers.asyncio import AsyncIOScheduler
from datetime import datetime, timedelta

scheduler = AsyncIOScheduler()

async def check_upcoming_appointments():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–ø–∏—Å–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å"""
    tomorrow = datetime.now() + timedelta(days=1)
    
    # –ü–æ–ª—É—á–∞–µ–º –∑–∞–ø–∏—Å–∏ –Ω–∞ –∑–∞–≤—Ç—Ä–∞
    appointments = await get_tomorrow_appointments()
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
    notifier = TelegramNotifier()
    for appointment in appointments:
        await notifier.send_appointment_reminder(
            telegram_id=appointment.user.telegram_id,
            appointment_data=appointment_data
        )

# –ó–∞–ø—É—Å–∫–∞—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 18:00
scheduler.add_job(
    check_upcoming_appointments,
    'cron',
    hour=18,
    minute=0
)

scheduler.start()
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# .env
BOT_TOKEN=your_telegram_bot_token_here
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –∫–æ–¥–µ

```python
# backend/src/shared/config/env_loader.py
class Config:
    bot_token: str = os.getenv("BOT_TOKEN")
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```python
notifier = TelegramNotifier()
success = await notifier.test_connection(telegram_id=123456789)
if success:
    print("‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç!")
```

### –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

```python
test_data = {
    "id": 1,
    "client_name": "–¢–µ—Å—Ç–æ–≤—ã–π –ö–ª–∏–µ–Ω—Ç",
    "client_phone": "+7 (999) 123-45-67",
    "service_name": "–¢–µ—Å—Ç–æ–≤–∞—è —É—Å–ª—É–≥–∞",
    "appointment_date": "2025-12-15T14:00:00",
    "duration_minutes": 60,
    "price": 1500.0
}

await notifier.send_new_appointment_notification(
    telegram_id=your_telegram_id,
    appointment_data=test_data
)
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–¢–æ–∫–µ–Ω –±–æ—Ç–∞** —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. **Telegram ID** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
3. **–û—à–∏–±–∫–∏** –ª–æ–≥–∏—Ä—É—é—Ç—Å—è, –Ω–æ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å
4. **–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—É –∑–∞–ø–∏—Å–∏

---

## üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:

```
‚úÖ Notification sent to user 123456789 for appointment 42
üì¨ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –º–∞—Å—Ç–µ—Ä—É 123456789
‚ùå Failed to send notification to user 123456789: Telegram error
```

---

## üöÄ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º (–µ—Å–ª–∏ –µ—Å—Ç—å Telegram ID)
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π (–∑–∞ 1 —á–∞—Å, 3 —á–∞—Å–∞, 1 –¥–µ–Ω—å)
- [ ] –ì—Ä—É–ø–ø–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–¥–∞–π–¥–∂–µ—Å—Ç –∑–∞ –¥–µ–Ω—å)
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–∏–±–ª–∏–∂–∞—é—â–∏—Ö—Å—è –≤—ã—Ö–æ–¥–Ω—ã—Ö
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º
- [ ] –ö–Ω–æ–ø–∫–∏ –±—ã—Å—Ç—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö (–ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å/–æ—Ç–º–µ–Ω–∏—Ç—å)

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ**
- –ï—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å, —ç—Ç–æ **–Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç** –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å
- –í—Å–µ –æ—à–∏–±–∫–∏ **–ª–æ–≥–∏—Ä—É—é—Ç—Å—è** –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –∫—Ä–∞—Å–∏–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-01  
**–í–µ—Ä—Å–∏—è:** 1.0.0
