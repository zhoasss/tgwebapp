# üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —É–ª—É—á—à–µ–Ω–∏–π

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î** (666 ‚Üí 660)  
‚úÖ **–ù–∞—Å—Ç—Ä–æ–µ–Ω—ã Alembic –º–∏–≥—Ä–∞—Ü–∏–∏**  
‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π –∑–∞–ø–∏—Å–µ–π**

---

## –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ª–æ–∫–∞–ª—å–Ω–æ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
git status

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å diff
git diff docker-compose.yml
```

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
# –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å –Ω–æ–≤—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ –ë–î
docker-compose down
docker-compose up --build -d

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs -f backend

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ
curl http://localhost/health
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

```bash
# –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞–ø–∏—Å—å
curl -X POST http://localhost/api/appointments \
  -H "Content-Type: application/json" \
  -H "X-Init-Data: <telegram_init_data>" \
  -d '{
    "service_id": 1,
    "client_id": 1,
    "appointment_date": "2025-12-01T14:00:00",
    "duration_minutes": 60
  }'

# –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–µ—Å–µ–∫–∞—é—â—É—é—Å—è –∑–∞–ø–∏—Å—å (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞)
curl -X POST http://localhost/api/appointments \
  -H "Content-Type: application/json" \
  -H "X-Init-Data: <telegram_init_data>" \
  -d '{
    "service_id": 1,
    "client_id": 2,
    "appointment_date": "2025-12-01T14:30:00",
    "duration_minutes": 60
  }'
# –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: 400 Bad Request
# "–í—Ä–µ–º—è –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞–ø–∏—Å—å—é..."
```

---

## –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞ production

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

```bash
# 1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@178.72.136.133

# 2. –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /path/to/zhoasss.github.io

# 3. –°–æ–∑–¥–∞—Ç—å backup –ë–î (–í–ê–ñ–ù–û!)
cp backend/database.db backend/database.db.backup.$(date +%Y%m%d_%H%M%S)
```

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

```bash
# 4. –ü–æ–ª—É—á–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull origin main

# 5. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
docker-compose down

# 6. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose up --build -d

# 7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs -f backend

# 8. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ —Å–µ—Ä–≤–∏—Å–æ–≤
curl http://localhost/health
curl https://booking-cab.ru/health
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î
ls -la backend/database.db
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: -rw-rw---- (660)

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É API
curl https://booking-cab.ru/api/test-no-auth
```

---

## –†–∞–±–æ—Ç–∞ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –ö–æ–≥–¥–∞ –≤—ã –∏–∑–º–µ–Ω–∏–ª–∏ –º–æ–¥–µ–ª–∏ –≤ models.py
cd backend
alembic revision --autogenerate -m "Add new field to User"
```

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
cd backend
alembic upgrade head

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é
alembic upgrade <revision_id>
```

### –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
cd backend
alembic downgrade -1

# –û—Ç–∫–∞—Ç–∏—Ç—å –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏
alembic downgrade <revision_id>
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
cd backend
alembic history

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é
alembic current
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π

### –ß–µ—Ä–µ–∑ Swagger UI

1. –û—Ç–∫—Ä–æ–π—Ç–µ `https://booking-cab.ru/api/docs`
2. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Telegram init data)
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –¥–≤–µ –ø–µ—Ä–µ—Å–µ–∫–∞—é—â–∏–µ—Å—è –∑–∞–ø–∏—Å–∏

### –ß–µ—Ä–µ–∑ curl

```bash
# –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –∑–∞–ø–∏—Å—å
curl -X POST https://booking-cab.ru/api/appointments \
  -H "Content-Type: application/json" \
  -H "X-Init-Data: <your_init_data>" \
  -d '{
    "service_id": 1,
    "client_id": 1,
    "appointment_date": "2025-12-01T14:00:00",
    "duration_minutes": 60,
    "notes": "–ü–µ—Ä–≤–∞—è –∑–∞–ø–∏—Å—å"
  }'

# –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–µ—Å–µ–∫–∞—é—â—É—é—Å—è (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞)
curl -X POST https://booking-cab.ru/api/appointments \
  -H "Content-Type: application/json" \
  -H "X-Init-Data: <your_init_data>" \
  -d '{
    "service_id": 1,
    "client_id": 2,
    "appointment_date": "2025-12-01T14:30:00",
    "duration_minutes": 60,
    "notes": "–ü–µ—Ä–µ—Å–µ–∫–∞—é—â–∞—è—Å—è –∑–∞–ø–∏—Å—å"
  }'
```

---

## –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

### –û—Ç–∫–∞—Ç –∫–æ–¥–∞

```bash
# –û—Ç–∫–∞—Ç–∏—Ç—å –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –∫–æ–º–º–∏—Ç—É
git reset --hard HEAD~1

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down
docker-compose up -d
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î

```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup
cp backend/database.db.backup.YYYYMMDD_HHMMSS backend/database.db

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
docker-compose restart
```

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏

```bash
# –í—Å–µ –ª–æ–≥–∏
docker-compose logs -f

# –¢–æ–ª—å–∫–æ backend
docker-compose logs -f backend

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
docker-compose logs --tail=100 backend
```

### –ú–µ—Ç—Ä–∏–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose ps
```

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –ë–î
cd backend
alembic current

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é
alembic history

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é
alembic upgrade head
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–ø–∏—Å–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ backend
docker-compose logs backend | grep -i error

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ISO 8601)
# –ü—Ä–∞–≤–∏–ª—å–Ω–æ: "2025-12-01T14:00:00"
# –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: "01.12.2025 14:00"
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞
ls -la backend/database.db

# –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –≤—Ä—É—á–Ω—É—é
chmod 660 backend/database.db

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å db –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose restart db
```

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Alembic:** https://alembic.sqlalchemy.org/
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** `README.md`
- **–î–µ—Ç–∞–ª–∏ —É–ª—É—á—à–µ–Ω–∏–π:** `IMPROVEMENTS_SUMMARY.md`
- **–ú–∏–≥—Ä–∞—Ü–∏–∏:** `MIGRATIONS_AND_OVERLAP_CHECK.md`

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs -f backend`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
3. –°–æ–∑–¥–∞–π—Ç–µ issue –≤ GitHub

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-11-28  
**–í–µ—Ä—Å–∏—è:** 1.0
